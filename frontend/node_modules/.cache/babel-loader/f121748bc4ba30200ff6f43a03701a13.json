{"ast":null,"code":"import _slicedToArray from\"/home/mosima/Desktop/red_tetris/frontend/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/slicedToArray\";import React,{useEffect,useState,useRef}from\"react\";import{pieces}from\"../misc/pieces\";/**********************************\\\n * canvas config data\n\\**********************************/var ROWS=20;var COLS=10;var EMPTY_BG=\"#765\";var BORDER=\"adf\";var BLOCK=30;/****\n * Canvas drawing functions\n */var drawBlock=function drawBlock(context,x,y){var colour=arguments.length>3&&arguments[3]!==undefined?arguments[3]:EMPTY_BG;var strokeColour=arguments.length>4&&arguments[4]!==undefined?arguments[4]:BORDER;context.fillStyle=colour;context.fillRect(x*BLOCK,y*BLOCK,BLOCK,BLOCK);context.strokeStyle=strokeColour;context.strokeRect(x*BLOCK,y*BLOCK,BLOCK,BLOCK);};/***\n * Tetramino Class\n */function Piece(context,grid,piece,colour){var _this=this;this.piece=piece;this.colour=colour;this.active=0;this.x=0;this.y=0;this.context=context;this.grid=grid;this.draw=function(){var active=arguments.length>0&&arguments[0]!==undefined?arguments[0]:_this.active;_this.active=active;for(var row=0;row<_this.piece[_this.active].length;row++){for(var col=0;col<_this.piece[_this.active][row].length;col++){if(_this.piece[_this.active][row][col])drawBlock(_this.context,_this.x+col,_this.y+row,_this.colour);}}};this.clear=function(){var active=arguments.length>0&&arguments[0]!==undefined?arguments[0]:_this.active;_this.active=active;for(var row=0;row<_this.piece[_this.active].length;row++){for(var col=0;col<_this.piece[_this.active][row].length;col++){if(_this.piece[_this.active][row][col])drawBlock(_this.context,_this.x+col,_this.y+row,EMPTY_BG);}}};this.lock=function(){for(var row=0;row<_this.piece[_this.active].length;row++){for(var col=0;col<_this.piece[_this.active][row].length;col++){if(_this.piece[_this.active][row][col])grid.coords[_this.y+row][_this.x+col]=_this.colour;}}};this.rotate=function(){if(!_this.isCollition(_this.x,_this.y,(_this.active+1)%4)){_this.clear();_this.active=(1+_this.active)%_this.piece.length;_this.draw();}else if(!_this.isCollition(_this.x+1,_this.y,(_this.active+1)%4)){_this.clear();_this.x=_this.x+1;_this.active=(1+_this.active)%_this.piece.length;_this.draw();}else if(!_this.isCollition(_this.x-1,_this.y,(_this.active+1)%4)){_this.clear();_this.x=_this.x-1;_this.active=(1+_this.active)%_this.piece.length;_this.draw();}else if(!_this.isCollition(_this.x-2,_this.y,(_this.active+1)%4)){_this.clear();_this.x=_this.x-2;_this.active=(1+_this.active)%_this.piece.length;_this.draw();}};this.moveLeft=function(){if(!_this.isCollition(_this.x-1)){_this.clear();_this.x=_this.x-1;_this.draw();}};this.moveRight=function(){if(!_this.isCollition(_this.x+1)){_this.clear();_this.x=_this.x+1;_this.draw();}};this.moveDown=function(){if(!_this.isCollition(_this.x,_this.y+1)){_this.clear();_this.y=_this.y+1;_this.draw();return true;}return false;};this.isCollition=function(){var newX=arguments.length>0&&arguments[0]!==undefined?arguments[0]:_this.x;var newY=arguments.length>1&&arguments[1]!==undefined?arguments[1]:_this.y;var newState=arguments.length>2&&arguments[2]!==undefined?arguments[2]:_this.active;for(var row=0;row<_this.piece[newState].length;row++){for(var col=0;col<_this.piece[newState][row].length;col++){if(_this.piece[newState][row][col]){if(newX+col<0||newX+col>=COLS||newY+row>=ROWS){console.log(\"collision\");return true;}console.log({grid:_this});if(_this.grid.coords[newY+row][newX+col]!==EMPTY_BG){return true;}}}}return false;};}/**\n * Grid class\n */function Grid(context){var _this2=this;var colums=arguments.length>1&&arguments[1]!==undefined?arguments[1]:COLS;var rows=arguments.length>2&&arguments[2]!==undefined?arguments[2]:ROWS;var backgroundColour=arguments.length>3&&arguments[3]!==undefined?arguments[3]:EMPTY_BG;this.colums=colums;this.rows=rows;this.colour=backgroundColour;this.coords=[];this.init=function(){for(var row=0;row<_this2.rows;row++){_this2.coords[row]=[];for(var col=0;col<_this2.colums;col++){_this2.coords[row][col]=EMPTY_BG;}}_this2.draw();};this.draw=function(){var r=0;var c=0;while(_this2.coords[r]){c=0;while(_this2.coords[r][c]){drawBlock(context,c,r,_this2.coords[r][c]);c++;}r++;}};}function penalty(grid){var y=0;while(grid.coords[y+1]){console.log(\"is it shifting?\");grid.coords[y]=grid.coords[y+1];y++;}grid.coords[y]=[];for(var c=0;c<COLS;c++){grid.coords[y][c]=\"red\";}grid.draw();}function controls(key,piece,grid){console.log({key:key});console.log({piece:piece});if(key===\"ArrowUp\")piece.rotate();if(key===\"ArrowLeft\")piece.moveLeft();if(key===\"ArrowRight\")piece.moveRight();if(key===\"ArrowDown\")piece.moveDown();if(key===\"l\")piece.lock();if(key===\"p\")penalty(grid);}var GameCanvas=function GameCanvas(){var canvasRef=useRef(null);var _useState=useState(null),_useState2=_slicedToArray(_useState,2),context=_useState2[0],setContext=_useState2[1];var _useState3=useState(null),_useState4=_slicedToArray(_useState3,2),grid=_useState4[0],setGrid=_useState4[1];var _useState5=useState(null),_useState6=_slicedToArray(_useState5,2),currentPiece=_useState6[0],setCurrentPiece=_useState6[1];useEffect(function(){if(canvasRef.current){var renderCtx=canvasRef.current.getContext(\"2d\");if(renderCtx){setContext(renderCtx);}}},[context]);useEffect(function(){if(context){if(!grid){var gr=new Grid(context);gr.init();setGrid(gr);console.log(gr);}else{console.log(\"grid already exist\");if(!currentPiece){var piece=new Piece(context,grid,pieces[0][0],pieces[0][1]);console.log({\"new piece\":piece});piece.draw();setCurrentPiece(piece);}else{console.log(\"current piece already set: \",currentPiece);}/**\n\t\t\t\t * this should be where the drawing magic happens\n\t\t\t\t */}}return function(){console.log(\"this is where the cleanup stuff happens\");};},[context,grid,currentPiece]);useEffect(function(){if(currentPiece){document.addEventListener(\"keydown\",function(_ref){var key=_ref.key;return controls(key,currentPiece,grid);});}return function(){document.removeEventListener(\"keydown\",function(_ref2){var key=_ref2.key;});};},[currentPiece,grid]);var _useState7=useState(0),_useState8=_slicedToArray(_useState7,2),seconds=_useState8[0],setSeconds=_useState8[1];useEffect(function(){var interval=setInterval(function(){setSeconds(function(seconds){return seconds+1;});if(currentPiece)if(!currentPiece.moveDown()){// currentPiece.lock()\nconsole.log(\"lock current piece and request for the next piece\");}},1000);return function(){return clearInterval(interval);};},[currentPiece]);return/*#__PURE__*/React.createElement(\"div\",{style:{textAlign:\"center\"}},/*#__PURE__*/React.createElement(\"h3\",null,seconds,\" seconds since mount\"),/*#__PURE__*/React.createElement(\"canvas\",{id:\"canvas\",ref:canvasRef,width:COLS*BLOCK,height:ROWS*BLOCK,style:{border:\"2px solid #000\",marginTop:10}}));};export default GameCanvas;","map":{"version":3,"sources":["/home/mosima/Desktop/red_tetris/frontend/src/components/GameCanvas.jsx"],"names":["React","useEffect","useState","useRef","pieces","ROWS","COLS","EMPTY_BG","BORDER","BLOCK","drawBlock","context","x","y","colour","strokeColour","fillStyle","fillRect","strokeStyle","strokeRect","Piece","grid","piece","active","draw","row","length","col","clear","lock","coords","rotate","isCollition","moveLeft","moveRight","moveDown","newX","newY","newState","console","log","Grid","colums","rows","backgroundColour","init","r","c","penalty","controls","key","GameCanvas","canvasRef","setContext","setGrid","currentPiece","setCurrentPiece","current","renderCtx","getContext","gr","document","addEventListener","removeEventListener","seconds","setSeconds","interval","setInterval","clearInterval","textAlign","border","marginTop"],"mappings":"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","sourcesContent":["import React, { useEffect, useState, useRef } from \"react\";\nimport { pieces } from \"../misc/pieces\";\n\n/**********************************\\\n * canvas config data\n\\**********************************/\nconst ROWS = 20;\nconst COLS = 10;\nconst EMPTY_BG = \"#765\";\nconst BORDER = \"adf\";\nconst BLOCK = 30;\n\n/****\n * Canvas drawing functions\n */\nconst drawBlock = (context, x, y, colour = EMPTY_BG, strokeColour = BORDER) => {\n\tcontext.fillStyle = colour;\n\tcontext.fillRect(x * BLOCK, y * BLOCK, BLOCK, BLOCK);\n\tcontext.strokeStyle = strokeColour;\n\tcontext.strokeRect(x * BLOCK, y * BLOCK, BLOCK, BLOCK);\n};\n\n/***\n * Tetramino Class\n */\n\nfunction Piece(context, grid, piece, colour) {\n\tthis.piece = piece;\n\tthis.colour = colour;\n\tthis.active = 0;\n\tthis.x = 0;\n\tthis.y = 0;\n\tthis.context = context;\n\tthis.grid = grid;\n\n\tthis.draw = (active = this.active) => {\n\t\tthis.active = active;\n\n\t\tfor (let row = 0; row < this.piece[this.active].length; row++) {\n\t\t\tfor (\n\t\t\t\tlet col = 0;\n\t\t\t\tcol < this.piece[this.active][row].length;\n\t\t\t\tcol++\n\t\t\t) {\n\t\t\t\tif (this.piece[this.active][row][col])\n\t\t\t\t\tdrawBlock(\n\t\t\t\t\t\tthis.context,\n\t\t\t\t\t\tthis.x + col,\n\t\t\t\t\t\tthis.y + row,\n\t\t\t\t\t\tthis.colour\n\t\t\t\t\t);\n\t\t\t}\n\t\t}\n\t};\n\tthis.clear = (active = this.active) => {\n\t\tthis.active = active;\n\n\t\tfor (let row = 0; row < this.piece[this.active].length; row++) {\n\t\t\tfor (\n\t\t\t\tlet col = 0;\n\t\t\t\tcol < this.piece[this.active][row].length;\n\t\t\t\tcol++\n\t\t\t) {\n\t\t\t\tif (this.piece[this.active][row][col])\n\t\t\t\t\tdrawBlock(\n\t\t\t\t\t\tthis.context,\n\t\t\t\t\t\tthis.x + col,\n\t\t\t\t\t\tthis.y + row,\n\t\t\t\t\t\tEMPTY_BG\n\t\t\t\t\t);\n\t\t\t}\n\t\t}\n\t};\n\tthis.lock = () => {\n\t\tfor (let row = 0; row < this.piece[this.active].length; row++) {\n\t\t\tfor (\n\t\t\t\tlet col = 0;\n\t\t\t\tcol < this.piece[this.active][row].length;\n\t\t\t\tcol++\n\t\t\t) {\n\t\t\t\tif (this.piece[this.active][row][col])\n\t\t\t\t\tgrid.coords[this.y + row][this.x + col] = this.colour;\n\t\t\t}\n\t\t}\n\t};\n\n\tthis.rotate = () => {\n\t\tif (!this.isCollition(this.x, this.y, (this.active + 1) % 4)) {\n\t\t\tthis.clear();\n\t\t\tthis.active = (1 + this.active) % this.piece.length;\n\t\t\tthis.draw();\n\t\t} else if (\n\t\t\t!this.isCollition(this.x + 1, this.y, (this.active + 1) % 4)\n\t\t) {\n\t\t\tthis.clear();\n\t\t\tthis.x = this.x + 1;\n\t\t\tthis.active = (1 + this.active) % this.piece.length;\n\t\t\tthis.draw();\n\t\t} else if (\n\t\t\t!this.isCollition(this.x - 1, this.y, (this.active + 1) % 4)\n\t\t) {\n\t\t\tthis.clear();\n\t\t\tthis.x = this.x - 1;\n\n\t\t\tthis.active = (1 + this.active) % this.piece.length;\n\t\t\tthis.draw();\n\t\t} else if (\n\t\t\t!this.isCollition(this.x - 2, this.y, (this.active + 1) % 4)\n\t\t) {\n\t\t\tthis.clear();\n\t\t\tthis.x = this.x - 2;\n\n\t\t\tthis.active = (1 + this.active) % this.piece.length;\n\t\t\tthis.draw();\n\t\t}\n\t};\n\n\tthis.moveLeft = () => {\n\t\tif (!this.isCollition(this.x - 1)) {\n\t\t\tthis.clear();\n\t\t\tthis.x = this.x - 1;\n\t\t\tthis.draw();\n\t\t}\n\t};\n\n\tthis.moveRight = () => {\n\t\tif (!this.isCollition(this.x + 1)) {\n\t\t\tthis.clear();\n\t\t\tthis.x = this.x + 1;\n\t\t\tthis.draw();\n\t\t}\n\t};\n\n\tthis.moveDown = () => {\n\t\tif (!this.isCollition(this.x, this.y + 1)) {\n\t\t\tthis.clear();\n\t\t\tthis.y = this.y + 1;\n\t\t\tthis.draw();\n\t\t\treturn true;\n\t\t}\n\t\treturn false;\n\t};\n\n\tthis.isCollition = (\n\t\tnewX = this.x,\n\t\tnewY = this.y,\n\t\tnewState = this.active\n\t) => {\n\t\tfor (let row = 0; row < this.piece[newState].length; row++) {\n\t\t\tfor (let col = 0; col < this.piece[newState][row].length; col++) {\n\t\t\t\tif (this.piece[newState][row][col]) {\n\t\t\t\t\tif (\n\t\t\t\t\t\tnewX + col < 0 ||\n\t\t\t\t\t\tnewX + col >= COLS ||\n\t\t\t\t\t\tnewY + row >= ROWS\n\t\t\t\t\t) {\n\t\t\t\t\t\tconsole.log(\"collision\");\n\t\t\t\t\t\treturn true;\n\t\t\t\t\t}\n\t\t\t\t\tconsole.log({ grid: this });\n\t\t\t\t\tif (this.grid.coords[newY + row][newX + col] !== EMPTY_BG) {\n\t\t\t\t\t\treturn true;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\treturn false;\n\t};\n}\n\n/**\n * Grid class\n */\n\nfunction Grid(\n\tcontext,\n\tcolums = COLS,\n\trows = ROWS,\n\tbackgroundColour = EMPTY_BG\n) {\n\tthis.colums = colums;\n\tthis.rows = rows;\n\tthis.colour = backgroundColour;\n\tthis.coords = [];\n\n\tthis.init = () => {\n\t\tfor (let row = 0; row < this.rows; row++) {\n\t\t\tthis.coords[row] = [];\n\t\t\tfor (let col = 0; col < this.colums; col++) {\n\t\t\t\tthis.coords[row][col] = EMPTY_BG;\n\t\t\t}\n\t\t}\n\t\tthis.draw();\n\t};\n\tthis.draw = () => {\n\t\tlet r = 0;\n\t\tlet c = 0;\n\t\twhile (this.coords[r]) {\n\t\t\tc = 0;\n\t\t\twhile (this.coords[r][c]) {\n\t\t\t\tdrawBlock(context, c, r, this.coords[r][c]);\n\t\t\t\tc++;\n\t\t\t}\n\t\t\tr++;\n\t\t}\n\t};\n}\n\nfunction penalty(grid) {\n\tlet y = 0;\n\twhile (grid.coords[y + 1]) {\n\t\tconsole.log(\"is it shifting?\");\n\t\tgrid.coords[y] = grid.coords[y + 1];\n\t\ty++;\n\t}\n\tgrid.coords[y] = [];\n\tfor (let c = 0; c < COLS; c++) {\n\t\tgrid.coords[y][c] = \"red\";\n\t}\n\tgrid.draw();\n}\n\nfunction controls(key, piece, grid) {\n\tconsole.log({ key });\n\tconsole.log({ piece });\n\tif (key === \"ArrowUp\") piece.rotate();\n\tif (key === \"ArrowLeft\") piece.moveLeft();\n\tif (key === \"ArrowRight\") piece.moveRight();\n\tif (key === \"ArrowDown\") piece.moveDown();\n\tif (key === \"l\") piece.lock();\n\tif (key === \"p\") penalty(grid);\n}\n\nconst GameCanvas = () => {\n\tconst canvasRef = useRef(null);\n\tconst [context, setContext] = useState(null);\n\tconst [grid, setGrid] = useState(null);\n\tconst [currentPiece, setCurrentPiece] = useState(null);\n\n\tuseEffect(() => {\n\t\tif (canvasRef.current) {\n\t\t\tconst renderCtx = canvasRef.current.getContext(\"2d\");\n\n\t\t\tif (renderCtx) {\n\t\t\t\tsetContext(renderCtx);\n\t\t\t}\n\t\t}\n\t}, [context]);\n\n\tuseEffect(() => {\n\t\tif (context) {\n\t\t\tif (!grid) {\n\t\t\t\tlet gr = new Grid(context);\n\t\t\t\tgr.init();\n\t\t\t\tsetGrid(gr);\n\t\t\t\tconsole.log(gr);\n\t\t\t} else {\n\t\t\t\tconsole.log(\"grid already exist\");\n\t\t\t\tif (!currentPiece) {\n\t\t\t\t\tlet piece = new Piece(\n\t\t\t\t\t\tcontext,\n\t\t\t\t\t\tgrid,\n\t\t\t\t\t\tpieces[0][0],\n\t\t\t\t\t\tpieces[0][1]\n\t\t\t\t\t);\n\t\t\t\t\tconsole.log({ \"new piece\": piece });\n\n\t\t\t\t\tpiece.draw();\n\t\t\t\t\tsetCurrentPiece(piece);\n\t\t\t\t} else {\n\t\t\t\t\tconsole.log(\"current piece already set: \", currentPiece);\n\t\t\t\t}\n\n\t\t\t\t/**\n\t\t\t\t * this should be where the drawing magic happens\n\t\t\t\t */\n\t\t\t}\n\t\t}\n\t\treturn () => {\n\t\t\tconsole.log(\"this is where the cleanup stuff happens\");\n\t\t};\n\t}, [context, grid, currentPiece]);\n\n\tuseEffect(() => {\n\t\tif (currentPiece) {\n\t\t\tdocument.addEventListener(\"keydown\", ({ key }) =>\n\t\t\t\tcontrols(key, currentPiece, grid)\n\t\t\t);\n\t\t}\n\t\treturn () => {\n\t\t\tdocument.removeEventListener(\"keydown\", ({ key }) => {});\n\t\t};\n\t}, [currentPiece, grid]);\n\n\tconst [seconds, setSeconds] = useState(0);\n\n\tuseEffect(() => {\n\t\tconst interval = setInterval(() => {\n\t\t\tsetSeconds((seconds) => seconds + 1);\n\t\t\tif (currentPiece)\n\t\t\t\tif (!currentPiece.moveDown()) {\n\t\t\t\t\t// currentPiece.lock()\n\t\t\t\t\tconsole.log(\n\t\t\t\t\t\t\"lock current piece and request for the next piece\"\n\t\t\t\t\t);\n\t\t\t\t}\n\t\t}, 1000);\n\t\treturn () => clearInterval(interval);\n\t}, [currentPiece]);\n\treturn (\n\t\t<div\n\t\t\tstyle={{\n\t\t\t\ttextAlign: \"center\",\n\t\t\t}}\n\t\t>\n\t\t\t<h3>{seconds} seconds since mount</h3>\n\t\t\t<canvas\n\t\t\t\tid=\"canvas\"\n\t\t\t\tref={canvasRef}\n\t\t\t\twidth={COLS * BLOCK}\n\t\t\t\theight={ROWS * BLOCK}\n\t\t\t\tstyle={{\n\t\t\t\t\tborder: \"2px solid #000\",\n\t\t\t\t\tmarginTop: 10,\n\t\t\t\t}}\n\t\t\t></canvas>\n\t\t</div>\n\t);\n};\n\nexport default GameCanvas;\n"]},"metadata":{},"sourceType":"module"}